"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var parseToFn=function(e){return"boolean"==typeof e?function(){return e}:e},getKey=function(e,i){e=e.toLowerCase();return"string"==typeof i&&(e+="#"+i.toLowerCase()),e};function initVisibilities(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t={};return Object.keys(i).forEach(function(e){e.startsWith("_")||(t[getKey(e)]=parseToFn(i[e]))}),t}function featuretoggleapi(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c={datas:{},listeners:{},visibilities:initVisibilities(e),showLogs:!1,usedPlugins:[]};function t(e,i){e(i)}function r(e,i){(c.listeners[e]||[]).forEach(function(e){e(i)})}function d(e){var i,t,n,r;c.showLogs&&("undefined"!=typeof window?(i=-1!=e.indexOf("<b>"),t=-1!=e.indexOf("visible"),n=-1!=e.indexOf("hidden"),r=(r=e.replace("visible","%cvisible")).replace("hidden","%chidden"),t?console.log(r,"color:green;font-weight:bold;"):n?console.log(r,"color:red;font-weight:bold;"):i?(r=r.replace("<b>","%c"),console.log.apply(null,[r,"font-weight:bold;"])):console.log(e)):(e=e.replace(/<b>/g,""),console.log(e)))}function b(e,i){return d(i),d(""),e}function y(e,i,t,n,r){if(null!=e){r=e({name:t,variant:n,data:r});return"boolean"==typeof r?r:b(!1,"The ".concat(i," returns ").concat(r,". => Please return true or false. This result (and all non-boolean results) will return false."))}}function l(e,i,t,n){t={name:e,variant:i,data:t};return t.key=getKey(t.name,t.variant),null==n||(t.visibilityFunction=parseToFn(n),t.result=t.visibilityFunction({name:t.name,variant:t.variant,data:t.data||{},_internalCall:!0,description:"When attaching a function, the result must be calculated internally. You can filter this out with the _internalCall:true -Flag."})),t}var i={name:"feature-toggle-api",setData:function(e,i,t){if(null==e)throw new Error("setData(): The name must of the feature must be defined, but ist undefined");i=l(e,null!=t?i:void 0,t||i);c.datas[i.key]=i.data,r("visibilityrule",i)},on:function(e,n,i){c.listeners[e]=c.listeners[e]||[],c.listeners[e].push(n),r("registerEvent",{type:e}),null!=i&&i.ignorePreviousRules||Object.keys(c.visibilities).forEach(function(e){var i,t,i={name:(t=(i=e).split("#"))[0],variant:1<t.length?t[1]:void 0,data:c.datas[i]},e=c.visibilities[e];i.result=e(i),n(i)})},trigger:r,showLogs:function(e){c.showLogs=null==e||e},isVisible:function(e,i,t){var n=c.visibilities;if(d('\nCheck Visibility of <b>Feature "'.concat(e,'", variant "').concat(null==i?"":i,'"').concat(t?" with data "+JSON.stringify(t):"",".")),null==e)throw new Error('The attribute "name" is required for tag <feature></feature>. Example: <feature name="aname"></feature>');var r=n._required,l=null!=n._required,o=y(r,"requiredVisibility",e,i,t),u=getKey(e,i),a=n[u],s=null!=n[u],f=y(a,"visibility function",e,i,t),r=null!=i,u=getKey(e,null),a=n[u],u=(n[u],y(a,"visibility function (only name)",e,i,t)),a=n._default,n=null!=n._default,t=y(a,"defaultVisibility",e,i,t);if(l){if(l&&!0===o)d("The requiredVisibility rule returns true. This feature will be shown when no other rule rejects it.");else if(l&&!1===o)return b(!1,"The requiredVisibility rule returns false. This feature will be hidden.")}else d("No requiredVisibility rule specified for this feature.");return s?b(f,"The visibility rule returns ".concat(f,". This feature will be ").concat(f?"visible":"hidden",".")):(d("No visibility rule found matching name and variant."),r&&"boolean"==typeof u?b(u,"Found a visibility rule for name ".concat(e," without variants. The rule returns ").concat(u,". => This feature will be ").concat(u?"visible":"hidden",".")):(r&&d("No rules found for name ".concat(e," without variants.")),n?b(t,"Found a defaultVisibility rule. The rule returns ".concat(t,". => This feature will be ").concat(t?"visible":"hidden",".")):(d("No default rule found."),l?b(!0,"Only the requiredVisibility rule was found. This returned true. => This feature will be visible."):b(!1,"No rules were found. This feature will be hidden."))))},visibility:function(e,i,t,n){n=function(e,i,t,n){if(null==e)throw new Error("feature.visibility(): 1st parameter name must be defined");if(1==arguments.length)throw new Error("feature.visibility(): 2nd parameter name must be a boolean or function, but is empty");var r=null,l=null,o=null,o=null==t&&null==n?i:null==n?(r=i,t):(r=i,l=t,n);return{name:e,variant:r,data:l,result:o}}(e,i,t,n),n=l(n.name,n.variant,n.data,n.result);c.visibilities[n.key]=n.visibilityFunction,c.datas[n.key]=n.data,r("visibilityrule",n)},requiredVisibility:function(e){if("function"!=typeof e)throw new Error("feature.requiredVisibility(): 1st parameter must be a function, but is "+_typeof(e));c.visibilities._required=parseToFn(e)},defaultVisibility:function(e){if("function"!=typeof e)throw new Error("feature.defaultVisibility(): 1st parameter must be a function, but is "+_typeof(e));c.visibilities._default=parseToFn(e)},addPlugin:function(e){c.usedPlugins.includes(e)||(t(e,i),c.usedPlugins.push(e))}};return function(i){if(e._plugins){if(!Array.isArray(e._plugins))throw new Error("featuretoggleapi()-constructor: config.plugins must be an array.");e._plugins.forEach(function(e){if("function"!=typeof e)throw new Error("featuretoggleapi()-constructor: config.plugins needs functions as entries, not "+_typeof(e)+".");t(e,i)})}r("init")}(i),i}window.featureToggleApi=featuretoggleapi;