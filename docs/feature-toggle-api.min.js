"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},parseToFn=function(e){return"boolean"==typeof e?function(){return e}:e};function initVisibilities(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t={};return Object.keys(i).forEach(function(e){e.startsWith("_")||(t[e]=parseToFn(i[e]))}),t}function featuretoggleapi(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},p={datas:{},listeners:{},visibilities:initVisibilities(e),showLogs:!1,usedPlugins:[]};function t(e,i){e(i)}function o(e,i){(p.listeners[e]||[]).forEach(function(e){e(i)})}var g=function(e){if(p.showLogs)if("undefined"!=typeof window){var i=-1!=e.indexOf("<b>"),t=-1!=e.indexOf("visible"),n=-1!=e.indexOf("hidden"),r=e.replace("visible","%cvisible");if(r=r.replace("hidden","%chidden"),t)console.log(r,"color:green;font-weight:bold;");else if(n)console.log(r,"color:red;font-weight:bold;");else if(i){var l=[r=r.replace("<b>","%c"),"font-weight:bold;"];console.log.apply(null,l)}else console.log(e)}else{var o=e.replace(/<b>/g,"");console.log(o)}},m=function(e,i){return g(i),g(""),e},w=function(e,i,t,n,r){if(null!=e){var l=e({name:t,variant:n,data:r});return"boolean"==typeof l?l:m(!1,"The "+i+" returns "+l+". => Please return true or false. This result (and all non-boolean results) will return false.")}};function T(e,i){var t=e.toLowerCase();return"string"==typeof i&&(t+="#"+i.toLowerCase()),t}function u(e,i,t,n){var r=void 0;return(r={name:e,variant:i,data:t}).key=T(r.name,r.variant),null==n||(r.visibilityFunction=parseToFn(n),r.result=r.visibilityFunction({name:r.name,variant:r.variant,data:r.data||{},_internalCall:!0,description:"When attaching a function, the result must be calculated internally. You can filter this out with the _internalCall:true -Flag."})),r}var i={name:"feature-toggle-api",setData:function(e,i,t){if(null==e)throw new Error("setData(): The name must of the feature must be defined, but ist undefined");var n=u(e,null!=t?i:void 0,t||i);return p.datas[n.key]=n.data,o("visibilityrule",n),Promise.resolve(n)},on:function(e,l,i){p.listeners[e]=p.listeners[e]||[],p.listeners[e].push(l),o("registerEvent",{type:e}),null!=i&&i.ignorePreviousRules||Object.keys(p.visibilities).forEach(function(e){var i,t,n={name:(t=(i=e).split("#"))[0],variant:1<t.length?t[1]:void 0,data:p.datas[i]},r=p.visibilities[e];n.result=r(n),l(n)})},trigger:o,showLogs:function(e){return p.showLogs=null==e||e,Promise.resolve(e)},isVisible:function(e,i,t){var n=p.visibilities;if(g('\nCheck Visibility of <b>Feature "'+e+'", variant "'+(null==i?"":i)+'"'+(t?" with data "+JSON.stringify(t):"")+"."),null==e)throw new Error('The attribute "name" is required for tag <feature></feature>. Example: <feature name="aname"></feature>');console.log(n);var r=n._required,l=null!=n._required,o=w(r,"requiredVisibility",e,i,t),u=T(e,i),s=n[u],a=null!=n[u],f=w(s,"visibility function",e,i,t),d=null!=i,b=n[T(e,null)],c=w(b,"visibility function (only name)",e,i,t),v=n._default,h=null!=n._default,y=w(v,"defaultVisibility",e,i,t);if(l){if(l&&!0===o)g("The requiredVisibility rule returns true. This feature will be shown when no other rule rejects it.");else if(l&&!1===o)return m(!1,"The requiredVisibility rule returns false. This feature will be hidden.")}else g("No requiredVisibility rule specified for this feature.");return a?m(f,"The visibility rule returns "+f+". This feature will be "+(f?"visible":"hidden")+"."):(g("No visibility rule found matching name and variant."),d&&"boolean"==typeof c?m(c,"Found a visibility rule for name "+e+" without variants. The rule returns "+c+". => This feature will be "+(c?"visible":"hidden")+"."):(d&&g("No rules found for name "+e+" without variants."),h?m(y,"Found a defaultVisibility rule. The rule returns "+y+". => This feature will be "+(y?"visible":"hidden")+"."):(g("No default rule found."),l?m(!0,"Only the requiredVisibility rule was found. This returned true. => This feature will be visible."):m(!1,"No rules were found. This feature will be hidden."))))},isVisiblePromise:function(){var e=this.isVisible.apply(this,arguments);return Promise.resolve(e)},visibility:function(e,i,t,n){var r=function(e,i,t,n){if(null==e)throw new Error("feature.visibility(): 1st parameter name must be defined");if(1==arguments.length)throw new Error("feature.visibility(): 2nd parameter name must be a boolean or function, but is empty");var r=null,l=null,o=null;return null==t&&null==n?o=i:null==n?(r=i,o=t):(r=i,l=t,o=n),{name:e,variant:r,data:l,result:o}}(e,i,t,n),l=u(r.name,r.variant,r.data,r.result);return p.visibilities[l.key]=l.visibilityFunction,p.datas[l.key]=l.data,o("visibilityrule",l),Promise.resolve(l)},requiredVisibility:function(e){if("function"!=typeof e)throw new Error("feature.requiredVisibility(): 1st parameter must be a function, but is "+(void 0===e?"undefined":_typeof(e)));return p.visibilities._required=parseToFn(e),Promise.resolve(e)},defaultVisibility:function(e){if("function"!=typeof e)throw new Error("feature.defaultVisibility(): 1st parameter must be a function, but is "+(void 0===e?"undefined":_typeof(e)));return p.visibilities._default=parseToFn(e),Promise.resolve(e)},addPlugin:function(e){if(!p.usedPlugins.includes(e))return t(e,i),p.usedPlugins.push(e),Promise.resolve(e)}};return function(i){if(e._plugins){if(!Array.isArray(e._plugins))throw new Error("featuretoggleapi()-constructor: config.plugins must be an array.");e._plugins.forEach(function(e){if("function"!=typeof e)throw new Error("featuretoggleapi()-constructor: config.plugins needs functions as entries, not "+(void 0===e?"undefined":_typeof(e))+".");t(e,i)})}o("init")}(i),i}window.featureToggleApi=featuretoggleapi;