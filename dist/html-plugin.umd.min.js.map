{"version":3,"file":"html-plugin.umd.min.js","sources":["../src/plugins/htmlplugin/plugin-html.ts"],"sourcesContent":["type Display = 'block' | 'inline-block' | 'inline' | 'flex' | 'inline-flex' | 'grid' | 'inline-grid';\n\ninterface HtmlPluginConfig {\n    renderedTag?: string,\n    featureTagName?: string,\n    tagAttributeName?: string,\n    nameAttributeName?:string,\n    variantAttributeName?: string,\n    dataAttributeName?: string,\n    displayAttributeName?: string,\n    defaultDisplay?: Display,\n}\n\n/*\n    creates a tag that is shown / hidden, depending on the visibility rules.\n    if not configured dynamically, it looks like this:\n    <feature name=\"featurename\" variant=\"variantname\" data=\"data\">content </feature>\n\n    Parameter: (config)\n    - config.featureTagName: name of the tag. Default: \"feature\"\n    - nameAttributeName: Name of the Name-Attribute: default: \"name\"\n    - variantAttributeName: Name of the Variant-Attribute: default: \"variant\"\n*/\nconst defaultparams :HtmlPluginConfig = {\n    renderedTag: 'div',\n    featureTagName: 'feature',\n    tagAttributeName: 'tag',\n    nameAttributeName:'name',\n    variantAttributeName: 'variant',\n    dataAttributeName: 'data',\n    displayAttributeName: 'display',\n    defaultDisplay: 'block',\n}\nfunction parseDataAttribute(attrAsString){\n    try{\n        return JSON.parse(attrAsString);\n    }\n    catch(e)\n    {\n        if(!isNaN(parseFloat(attrAsString)))\n            return parseFloat(attrAsString);\n        \n        return attrAsString;\n    }\n}\n\nfunction htmlPlugin(config :HtmlPluginConfig = {}) {\n    config = Object.assign({},defaultparams,config);\n\n    function renderFeatureTag(elem:HTMLElement,isVisible){\n        const tagname = elem.getAttribute(config.tagAttributeName) || config.renderedTag;\n        const attributes = Array.from(elem.attributes);\n        let attributesAsString = \"\";\n        attributes.forEach(attr => {\n            attributesAsString += ` ${attr.nodeName}=\"${attr.nodeValue.replace(/\"/g,\"&quot;\")}\"`;\n        });\n        const display = isVisible ? (elem.getAttribute(config.displayAttributeName) || config.defaultDisplay) : 'none';\n        elem.outerHTML = `<${tagname}  style=\"display:${display}\" _feature=\"true\" ${attributesAsString}>${elem.innerHTML}</${tagname}>`;\n    } \n    return function (api) {\n        var renderedTags :NodeListOf<HTMLElement> = window.document.querySelectorAll(config.featureTagName);\n        renderedTags.forEach(tag => { renderFeatureTag(tag,false) });\n\n        api.on('visibilityrule', function (event) {\n            var selector = `[_feature][${config.nameAttributeName}=\"${event.name}\"]`;\n            if (event.variant) selector += `[${config.variantAttributeName}=\"${event.variant}\"]`;\n            var elements :NodeListOf<HTMLElement> = document.querySelectorAll(selector);\n            elements.forEach(elem => { \n                const dataAsString = elem.getAttribute(config.dataAttributeName);\n                const data = parseDataAttribute(dataAsString);\n                \n                const isVisible = api.isVisible(event.name,event.variant,data);\n                renderFeatureTag(elem, isVisible);\n            });\n        })\n\n        return { name: 'htmlplugin' };\n    }\n}\n\nexport {\n    htmlPlugin\n}"],"names":["defaultparams","renderedTag","featureTagName","tagAttributeName","nameAttributeName","variantAttributeName","dataAttributeName","displayAttributeName","defaultDisplay","config","renderFeatureTag","elem","isVisible","tagname","getAttribute","attributes","Array","from","attributesAsString","forEach","attr","nodeName","nodeValue","replace","display","outerHTML","innerHTML","Object","assign","api","window","document","querySelectorAll","tag","on","event","selector","name","variant","data","attrAsString","JSON","parse","e","isNaN","parseFloat","parseDataAttribute"],"mappings":"+PAuBA,MAAMA,EAAkC,CACpCC,YAAa,MACbC,eAAgB,UAChBC,iBAAkB,MAClBC,kBAAkB,OAClBC,qBAAsB,UACtBC,kBAAmB,OACnBC,qBAAsB,UACtBC,eAAgB,sBAepB,SAAoBC,EAA2B,IAG3C,SAASC,EAAiBC,EAAiBC,GACvC,MAAMC,EAAUF,EAAKG,aAAaL,EAAON,mBAAqBM,EAAOR,YAC/Dc,EAAaC,MAAMC,KAAKN,EAAKI,YACnC,IAAIG,EAAqB,GACzBH,EAAWI,SAAQC,IACfF,GAAsB,IAAIE,EAAKC,aAAaD,EAAKE,UAAUC,QAAQ,KAAK,YAAY,IAExF,MAAMC,EAAUZ,EAAaD,EAAKG,aAAaL,EAAOF,uBAAyBE,EAAOD,eAAkB,OACxGG,EAAKc,UAAY,IAAIZ,qBAA2BW,sBAA4BN,KAAsBP,EAAKe,cAAcb,KAEzH,OAZAJ,EAASkB,OAAOC,OAAO,CAAA,EAAG5B,EAAcS,GAYjC,SAAUoB,GAiBb,OAhB4CC,OAAOC,SAASC,iBAAiBvB,EAAOP,gBACvEiB,SAAQc,IAASvB,EAAiBuB,GAAI,EAAM,IAEzDJ,EAAIK,GAAG,kBAAkB,SAAUC,GAC/B,IAAIC,EAAW,cAAc3B,EAAOL,sBAAsB+B,EAAME,SAC5DF,EAAMG,UAASF,GAAY,IAAI3B,EAAOJ,yBAAyB8B,EAAMG,aACjCP,SAASC,iBAAiBI,GACzDjB,SAAQR,IACb,MACM4B,EApCtB,SAA4BC,GACxB,IACI,OAAOC,KAAKC,MAAMF,GAEtB,MAAMG,GAEF,OAAIC,MAAMC,WAAWL,IAGdA,EAFIK,WAAWL,GAI9B,CAyB6BM,CADQnC,EAAKG,aAAaL,EAAOH,oBAI9CI,EAAiBC,EADCkB,EAAIjB,UAAUuB,EAAME,KAAKF,EAAMG,QAAQC,GACxB,GAEzC,IAEO,CAAEF,KAAM,aAClB,CACL"}