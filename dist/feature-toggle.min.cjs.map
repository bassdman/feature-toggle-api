{"version":3,"file":"feature-toggle.min.cjs","sources":["../src/plugins/htmlplugin/plugin-html.ts","../src/featureToggle.ts","../src/plugins/urlplugin/plugin-url.ts"],"sourcesContent":["type Display = 'block' | 'inline-block' | 'inline' | 'flex' | 'inline-flex' | 'grid' | 'inline-grid';\n\ninterface HtmlPluginConfig {\n    renderedTag?: string,\n    featureTagName?: string,\n    tagAttributeName?: string,\n    nameAttributeName?:string,\n    variantAttributeName?: string,\n    dataAttributeName?: string,\n    displayAttributeName?: string,\n    defaultDisplay?: Display,\n}\n\n/*\n    creates a tag that is shown / hidden, depending on the visibility rules.\n    if not configured dynamically, it looks like this:\n    <feature name=\"featurename\" variant=\"variantname\" data=\"data\">content </feature>\n\n    Parameter: (config)\n    - config.featureTagName: name of the tag. Default: \"feature\"\n    - nameAttributeName: Name of the Name-Attribute: default: \"name\"\n    - variantAttributeName: Name of the Variant-Attribute: default: \"variant\"\n*/\nconst defaultparams :HtmlPluginConfig = {\n    renderedTag: 'div',\n    featureTagName: 'feature',\n    tagAttributeName: 'tag',\n    nameAttributeName:'name',\n    variantAttributeName: 'variant',\n    dataAttributeName: 'data',\n    displayAttributeName: 'display',\n    defaultDisplay: 'block',\n}\nfunction parseDataAttribute(attrAsString){\n    try{\n        return JSON.parse(attrAsString);\n    }\n    catch(e)\n    {\n        if(!isNaN(parseFloat(attrAsString)))\n            return parseFloat(attrAsString);\n        \n        return attrAsString;\n    }\n}\n\nfunction htmlPlugin(config :HtmlPluginConfig = {}) {\n    config = Object.assign({},defaultparams,config);\n\n    function renderFeatureTag(elem:HTMLElement,isVisible){\n        const tagname = elem.getAttribute(config.tagAttributeName) || config.renderedTag;\n        const attributes = Array.from(elem.attributes);\n        let attributesAsString = \"\";\n        attributes.forEach(attr => {\n            attributesAsString += ` ${attr.nodeName}=\"${attr.nodeValue.replace(/\"/g,\"&quot;\")}\"`;\n        });\n        const display = isVisible ? (elem.getAttribute(config.displayAttributeName) || config.defaultDisplay) : 'none';\n        elem.outerHTML = `<${tagname}  style=\"display:${display}\" _feature=\"true\" ${attributesAsString}>${elem.innerHTML}</${tagname}>`;\n    } \n    return function (api) {\n        var renderedTags :NodeListOf<HTMLElement> = window.document.querySelectorAll(config.featureTagName);\n        renderedTags.forEach(tag => { renderFeatureTag(tag,false) });\n\n        api.on('visibilityrule', function (event) {\n            var selector = `[_feature][${config.nameAttributeName}=\"${event.name}\"]`;\n            if (event.variant) selector += `[${config.variantAttributeName}=\"${event.variant}\"]`;\n            var elements :NodeListOf<HTMLElement> = document.querySelectorAll(selector);\n            elements.forEach(elem => { \n                const dataAsString = elem.getAttribute(config.dataAttributeName);\n                const data = parseDataAttribute(dataAsString);\n                \n                const isVisible = api.isVisible(event.name,event.variant,data);\n                renderFeatureTag(elem, isVisible);\n            });\n        })\n\n        return { name: 'htmlplugin' };\n    }\n}\n\nexport {\n    htmlPlugin\n}","import { EventType, FeatureToggleApi, FeatureToggleConfig, OnEvent } from \"./types\";\n\nfunction parseToFn(fnOrBool: boolean | ((param?: any) => boolean)) {\n    if (typeof fnOrBool == 'boolean')\n        return function () { return fnOrBool };\n\n    return fnOrBool;\n}\n\nfunction getKey(name: string, variant?: string): string {\n    var _name = name.toLowerCase();\n    if (variant && typeof variant == 'string') {\n        _name += \"#\" + variant.toLowerCase();\n    }\n\n    return _name;\n}\n\nfunction initVisibilities(visibilities: FeatureToggleConfig = {}) {\n    const returnVisibilities = {};\n    Object.keys(visibilities).forEach(key => {\n        if (key.startsWith('_') || key.startsWith('$'))\n            return;\n        returnVisibilities[getKey(key)] = parseToFn(visibilities[key]);\n    });\n    return returnVisibilities;\n}\n\nfunction useFeatureToggle(config: FeatureToggleConfig = {}): FeatureToggleApi {\n\n    const globals = {\n        datas: {},\n        listeners: {},\n        visibilities: initVisibilities(config),\n        showLogs: false,\n        usedPlugins: [],\n    }\n\n    function init(api: FeatureToggleApi) {\n        if(config.$default){\n            api.setDefaultFlag(config.$default);\n        }\n\n        if(config.$required){\n            api.setRequiredFlag(config.$required);\n        }\n\n        const allPlugins = [...(config.$plugins||[]),...(config._plugins||[])];\n        if(config._plugins){\n            console.log('useFeatureToggle({_plugins:[]}): Key _plugins is deprecated. Use $plugins instead. This attribute will be removed in one of the next major versions.');\n        }\n\n\n        if (allPlugins.length) {\n            allPlugins.forEach(plugin => {\n                if (typeof plugin !== 'function')\n                    throw new Error('featuretoggleapi()-constructor: config.plugins needs functions as entries, not ' + typeof plugin + '.');\n\n                api.addPlugin(plugin);\n            });\n        }\n\n        triggerEvent('init');\n    }\n\n    function triggerEvent(eventtype: EventType, param?: any) {\n        (globals.listeners[eventtype] || []).forEach(listener => {\n            listener(param);\n        });\n    }\n\n    const log = function (message) {\n        if (!globals.showLogs)\n            return;\n\n        //Nur Browser k√∂nnen Syntaxhighlighting die anderen geben die Nachricht einfach aus und schneiden\n        //die styletags raus\n        if (typeof window === 'undefined') {\n            const loggedMessage = message.replace(/<b>/g, \"\");\n            console.log(loggedMessage);\n            return;\n        }\n\n        var hasBoldTag = message.indexOf('<b>') != -1;\n        var hasVisibleKeyword = message.indexOf('visible') != -1;\n        var hasHiddenKeyword = message.indexOf('hidden') != -1;\n\n        var _message = message.replace('visible', '%cvisible');\n        _message = _message.replace('hidden', '%chidden');\n\n        if (hasVisibleKeyword)\n            console.log(_message, \"color:green;font-weight:bold;\");\n        else if (hasHiddenKeyword)\n            console.log(_message, \"color:red;font-weight:bold;\");\n        else if (hasBoldTag) {\n            _message = _message.replace('<b>', '%c');\n            var parts = [_message, 'font-weight:bold;']\n            console.log.apply(null, parts);\n        }\n        else\n            console.log(message);\n    }\n\n    const logAndReturn = function (returnValue, message) {\n        log(message);\n        log('');\n        return returnValue;\n    }\n\n    const getVisibility = function (visibilityFn, functionname, name, variant, data) {\n        if (visibilityFn == null)\n            return undefined;\n\n        var calculatedVisibility = visibilityFn({ name: name, variant: variant, data: data });\n\n        if (typeof calculatedVisibility == 'boolean') {\n            return calculatedVisibility;\n        }\n\n        return logAndReturn(false, `The ${functionname} returns ${calculatedVisibility}. => Please return true or false. This result (and all non-boolean results) will return false.`);\n    }\n\n    function parseKey(key: string): OnEvent {\n        const parts = key.split('#');\n        return {\n            name: parts[0],\n            variant: parts.length > 1 ? parts[1] : undefined,\n            data: globals.datas[key],\n        }\n    }\n\n    /*\n        the following calls are possible:\n        visibility(name,result);\n        visibility(name,variant,result);\n        visibility(name,variant,data,result);\n    \n        =>\n        param1: name\n        param2: result || variant\n        param3: result || data\n        param4: result\n    */\n    function visibilityFnParams(param1, param2, param3, param4) {\n        //name must always be set\n        if (param1 == undefined)\n            throw new Error('feature.visibility(): 1st parameter name must be defined');\n\n        if (arguments.length == 1)\n            throw new Error('feature.visibility(): 2nd parameter name must be a boolean or function, but is empty');\n\n        let name = param1, variant = null, data = null, result = null;\n        if (param3 == undefined && param4 == undefined) {\n            result = param2;\n        }\n        else if (param4 == undefined) {\n            variant = param2;\n            result = param3;\n        }\n        else {\n            variant = param2;\n            data = param3;\n            result = param4;\n        }\n\n        return {\n            name,\n            variant,\n            data,\n            result\n        }\n    }\n\n    function getEvent(name: string, variant: string, data?, result?: any) {\n\n        let event;\n\n        event = { name, variant, data };\n\n        event.key = getKey(event.name, event.variant);\n\n        if (result == null)\n            return event;\n\n        event.visibilityFunction = parseToFn(result);\n        event.result = event.visibilityFunction({\n            name: event.name,\n            variant: event.variant,\n            data: event.data || {},\n            _internalCall: true,\n            description: 'When attaching a function, the result must be calculated internally. You can filter this out with the _internalCall:true -Flag.'\n        })\n        return event;\n    }\n\n\n\n    function isActive(name: string, variant?: string, data?: any): boolean {\n        const visibilities = globals.visibilities;\n\n        log(`\\nCheck Visibility of <b>Feature \"${name}\", variant \"${variant == undefined ? '' : variant}\"${data ? \" with data \" + JSON.stringify(data) : \"\"}.`);\n        if (name == undefined)\n            throw new Error('The attribute \"name\" is required for tag <feature></feature>. Example: <feature name=\"aname\"></feature>');\n\n        var requiredFn = visibilities['_required'];\n        var requiredFnExists = visibilities['_required'] != null;\n        var requiredFnResult = getVisibility(requiredFn, 'requiredVisibility', name, variant, data);\n\n        var visibilityFnKey = getKey(name, variant);\n        var visibilityFn = visibilities[visibilityFnKey];\n        var visibilityFnExists = visibilities[visibilityFnKey] != null;\n        var visibilityFnResult = getVisibility(visibilityFn, 'visibility function', name, variant, data);\n\n        var variantExists = variant != null;\n        var visibilityOnlyNameFnKey = getKey(name, null);\n        var visibilityOnlyNameFn = visibilities[visibilityOnlyNameFnKey];\n        var visibilityOnlyNameFnExists = visibilities[visibilityOnlyNameFnKey] != null;\n        var visibilityOnlyNameFnResult = getVisibility(visibilityOnlyNameFn, 'visibility function (only name)', name, variant, data);\n\n        var defaultFn = visibilities['_default'];\n        var defaultFnExists = visibilities['_default'] != null;\n        var defaultFnResult = getVisibility(defaultFn, 'defaultVisibility', name, variant, data);\n\n        if (!requiredFnExists)\n            log(\"No requiredVisibility rule specified for this feature.\");\n        else if (requiredFnExists && requiredFnResult === true)\n            log(\"The requiredVisibility rule returns true. This feature will be shown when no other rule rejects it.\")\n        else if (requiredFnExists && requiredFnResult === false)\n            return logAndReturn(false, \"The requiredVisibility rule returns false. This feature will be hidden.\");\n\n        if (visibilityFnExists)\n            return logAndReturn(visibilityFnResult, `The visibility rule returns ${visibilityFnResult}. This feature will be ${visibilityFnResult ? 'visible' : 'hidden'}.`);\n        log('No visibility rule found matching name and variant.');\n\n        if (variantExists && typeof visibilityOnlyNameFnResult == 'boolean')\n            return logAndReturn(visibilityOnlyNameFnResult, `Found a visibility rule for name ${name} without variants. The rule returns ${visibilityOnlyNameFnResult}. => This feature will be ${visibilityOnlyNameFnResult ? 'visible' : 'hidden'}.`);\n        else if (variantExists)\n            log(`No rules found for name ${name} without variants.`)\n\n\n        if (defaultFnExists)\n            return logAndReturn(defaultFnResult, `Found a defaultVisibility rule. The rule returns ${defaultFnResult}. => This feature will be ${defaultFnResult ? 'visible' : 'hidden'}.`);\n        log(`No default rule found.`)\n\n        if (requiredFnExists)\n            return logAndReturn(true, `Only the requiredVisibility rule was found. This returned true. => This feature will be visible.`);\n\n        return logAndReturn(false, 'No rules were found. This feature will be hidden.');\n    }\n\n    const api: FeatureToggleApi = {\n        name: 'feature-toggle-api',\n        setData: function (nameParam, variantOrDataParam, dataParam?): void {\n            if (nameParam == undefined)\n                throw new Error('setData(): The name must of the feature must be defined, but ist undefined');\n\n            const variant = (dataParam != undefined ? variantOrDataParam : undefined) as string;\n            const data = dataParam || variantOrDataParam;\n\n            const event = getEvent(nameParam, variant, data);\n\n            globals.datas[event.key] = event.data;\n\n            triggerEvent('visibilityrule', event);\n        },\n        on(eventtype: EventType, fn, config?) {\n            globals.listeners[eventtype] = globals.listeners[eventtype] || [];\n            globals.listeners[eventtype].push(fn);\n\n            triggerEvent('registerEvent', {\n                type: eventtype\n            })\n            if (config != undefined && config.ignorePreviousRules)\n                return;\n\n            \n            Object.keys(globals.visibilities).forEach(key => {\n                const event = parseKey(key);\n                const rule = globals.visibilities[key];\n                event.result = rule(event);\n                fn(event);\n            });\n        },\n        trigger: triggerEvent,\n        showLogs: function (showLogs?: boolean): void {\n            globals.showLogs = showLogs == undefined ? true : showLogs;\n        },\n        isVisible(name,variant,data){\n            console.log('featureToggle.isVisible is deprecated. use featureToggle.isActive instead. This function will be removed in one of the next major versions.');\n            return isActive(name,variant,data);\n        },\n        isActive,\n        /**\n            the following function calls are possible:\n            visibility(name,result);\n            visibility(name,variant,result);\n            visibility(name,variant,data,result);\n         */\n        setFlag(name, resultOrVariant, resultOrData?, result?) {\n            const params = visibilityFnParams(name, resultOrVariant, resultOrData, result);\n            const event = getEvent(params.name, params.variant, params.data, params.result);\n\n            globals.visibilities[event.key] = event.visibilityFunction;\n            globals.datas[event.key] = event.data;\n            triggerEvent('visibilityrule', event);\n        },\n        visibility: function (name, resultOrVariant, resultOrData?, result?) {\n            console.log('featureToggle.visibility is deprecated. use featureToggle.setVisibility instead. This function will be removed in one of the next major versions.');\n\n            api.setFlag(name, resultOrVariant, resultOrData, result);\n        },\n        requiredVisibility: function (fn) {\n            console.log('featureToggle.requiredVisibility is deprecated. use featureToggle.setRequiredFlag instead. This function will be removed in one of the next major versions.');\n\n            api.setRequiredFlag(fn);\n        },\n        defaultVisibility: function (fn) {\n            console.log('featureToggle.requiredVisibility is deprecated. use featureToggle.setRequiredFlag instead. This function will be removed in one of the next major versions.');\n\n            api.setDefaultFlag(fn);\n        },\n        setRequiredFlag(fn) {\n            if (typeof fn != \"function\")\n                throw new Error('feature.setRequiredFlag(): 1st parameter must be a function, but is ' + typeof fn);\n\n            globals.visibilities['_required'] = parseToFn(fn);\n        },\n        setDefaultFlag(fn) {\n            if (typeof fn != \"function\")\n                throw new Error('feature.defaultVisibility(): 1st parameter must be a function, but is ' + typeof fn);\n\n            globals.visibilities['_default'] = parseToFn(fn);\n        },\n        addPlugin: function (plugin) {\n            if (globals.usedPlugins.includes(plugin))\n                return;\n\n            const newPlugin = plugin(api);\n\n            for(let _key of Object.keys(newPlugin)){\n                api[_key] = newPlugin[_key];\n            }\n\n            globals.usedPlugins.push(plugin);\n        },\n    };\n    init(api);\n\n    return api;\n}\n\nexport default useFeatureToggle;","interface URLPluginConfig{\n    useMockedWindow?: boolean,\n    url?: string,\n    prefix?: string\n\n}\n\nfunction useWindowMock(){\n    return {\n        isMocked: true,\n        decodeURIComponent:function(param1){\n            return param1;\n        }\n    }\n}\n\ndeclare global {\n    interface Window {\n      isMocked: boolean\n    }\n  }\n\n  declare var window: Window;\n\nfunction parseValue(value){\n    if(value === 'true')\n        return true;\n    return false;\n}\n\nfunction getParams(url,window) {\n    var params = {};\n    if (!url) \n        return [];\n    \n    var urlparts = url.split(\"?\");\n\n    //no params available for url\n    if(urlparts.length < 2)\n        return [];\n\n    const parts = urlparts[1].split('&');\n\n    parts.forEach(function (part) {\n    var pair = part.split('=');\n    pair[0] = window.decodeURIComponent(pair[0]);\n    pair[1] = parseValue(window.decodeURIComponent(pair[1]));\n    params[pair[0]] = (pair[1] !== 'undefined') ?\n        pair[1] : true;\n    });\n\n    return params;\n  }\n\n function urlPlugin(config: URLPluginConfig={}) {\n    let _window;\n\n    if(config.useMockedWindow)\n        _window = useWindowMock();\n    else\n        _window = window;\n    \n    config = Object.assign({},{\n        url: _window.isMocked ? \"\" : _window.location.href,\n        prefix: \"\"\n    },config);\n\n    \n\n    return function(api){\n        api.url = config.url;\n        const urlparams = getParams(config.url,_window);\n        const prefix = config.prefix;\n\n        Object.keys(urlparams).forEach(key => {\n            if(!key.startsWith(prefix))\n                return;\n                \n            const keyWithoutPrefix = key.replace(prefix,\"\");\n            api.visibility(keyWithoutPrefix,urlparams[key]);\n        });\n\n        return {name: 'urlplugin'};\n    }\n\n}\n\nexport {\n    urlPlugin\n}"],"names":["defaultparams","renderedTag","featureTagName","tagAttributeName","nameAttributeName","variantAttributeName","dataAttributeName","displayAttributeName","defaultDisplay","parseToFn","fnOrBool","getKey","name","variant","_name","toLowerCase","initVisibilities","visibilities","returnVisibilities","Object","keys","forEach","key","startsWith","config","renderFeatureTag","elem","isVisible","tagname","getAttribute","attributes","Array","from","attributesAsString","attr","nodeName","nodeValue","replace","display","outerHTML","innerHTML","assign","api","window","document","querySelectorAll","tag","on","event","selector","data","attrAsString","JSON","parse","e","isNaN","parseFloat","parseDataAttribute","_window","useMockedWindow","isMocked","decodeURIComponent","param1","url","location","href","prefix","urlparams","params","urlparts","split","length","part","pair","getParams","keyWithoutPrefix","visibility","globals","datas","listeners","showLogs","usedPlugins","triggerEvent","eventtype","param","listener","log","message","hasBoldTag","indexOf","hasVisibleKeyword","hasHiddenKeyword","_message","console","parts","apply","loggedMessage","logAndReturn","returnValue","getVisibility","visibilityFn","functionname","calculatedVisibility","getEvent","result","visibilityFunction","_internalCall","description","isActive","undefined","stringify","Error","requiredFn","requiredFnExists","requiredFnResult","visibilityFnKey","visibilityFnExists","visibilityFnResult","variantExists","visibilityOnlyNameFn","visibilityOnlyNameFnResult","defaultFn","defaultFnExists","defaultFnResult","setData","nameParam","variantOrDataParam","dataParam","fn","push","type","ignorePreviousRules","parseKey","rule","trigger","setFlag","resultOrVariant","resultOrData","param2","param3","param4","arguments","visibilityFnParams","requiredVisibility","setRequiredFlag","defaultVisibility","setDefaultFlag","addPlugin","plugin","includes","newPlugin","_key","$default","$required","allPlugins","$plugins","_plugins","init"],"mappings":"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"}